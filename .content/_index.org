# Created 2021-02-13 Sat 17:25
#+TITLE: README
#+DATE: <2020-08-06 Thu>
#+AUTHOR: Ben Mezger
#+subtitle: My personal dotfiles
#+infojs_opt: view:t toc:t ltoc:t mouse:underline
#+export_file_name: ./.content/_index.org

/Github does not render orgmode files properly, [[https://benmezger.github.io/dotfiles][see]] for a better view of this
documentation./

* Features
- Auto install all system dependencies
- Applies secrets and password with =bitwarden=
- Custom scripts in =.bin=
- =Alacritty= config based on OS
- =fish= configuration
- =neomutt= support with multiple accounts
- =msmtp= for sending emails with multiple account support
- =mbsync= for syncing emails with multiple account support
- Custom =curl= configuration
- Custom =dircolors= (Gruvbox-dark colorscheme)
- Custom =gitconfig=
  - Custom =git= templates for commit messages
- Custom =tmux= configuration
  - =Gitmux= configuration
  - =Gruvbox= colorscheme
- Custom =zsh= configuration
  - Auto attach a =tmux= session when running on OSX
  - Sources a custom =env= file for secret keys
  - Fast =zsh= prompt with =git= =RPROMPT= enabled
  - Custom completion files enabled
  - =fzf= enabled for reverse search
  - =pyenv= support
  - =wakatime= support
- Custom =bash= configuration
- Custom =emacs doom= configuration
  - =wakatime= support
  - =mu4e= enabled
- Custom =gnupg= configuration
- Custom =inputrc= configuration
- Custom =pythonrc= configuration
- Clean =vim= configuration
- Custom =editorconfig= configuration
- Custom =weechat= configuration

** OSX features
- Auto start a =tmux= session with =launchctl=
- Custom OSX preference setup
- Run =isync= and =mu= with =launchctl= every 5min

** Archlinux features
- Auto start =greenclip= with =systemd=
- Run =isync= and =mu= with =systemd= every 5min
- =i3-display= support for handling multi-monitor
- Custom =i3wm= configuration
  - Custom =i3status-rs= support with Gruvbox colorscheme
  - =polybar= support
- =picom= support
- =rofi= support with clipboard manager
- Minimal =dunst= notification manager
- Custom =user-dirs= configuration
* Screenshots
** Archlinux
[[file:./arch-screenshot.png]]

** OSX
[[file:./osx-screenshot.png]]


* Auto installer
Run =bash install.sh=, which installs the required dependencies for running the system

* Installing manually with Makefile
** Requirements
- [[https://www.gnu.org/software/make/manual/make.html][Make]]

See =make help= for all available options

* Installing manually with Chezmoi
** Requirements
- [[https://www.chezmoi.io/][Chezmoi]]
- [[https://bitwarden.com/help/article/cli/#quick-start][Bitwarden-cli]]
** Installing
Run =chezmoi init https://github.com/benmezger/dotfiles.git= (see [[https://www.chezmoi.io/docs/reference/][reference]] for
more options) to checkout the repository and any submodules. Finally, run
=chezmoi apply= to move changes to your home directory.

Chezmoi will try to apply bitwarden in [[file:dot_env-secrets.tmpl][env-secrets]] if =CI= env is not set or
=secrets= is set to =true= in =chezmoi.yaml= (defaults to =false=). Make sure
the UUID are correct with your password's UUID, [[https://www.chezmoi.io/docs/reference/#onepassword-uuid-vault-uuid][see]] for more information or set
a =CI= env variable before running to skip this step.

* Dependencies
- Fonts
  - [[https://github.com/chrissimpkins/codeface/tree/master/fonts/inconsolata-dz][Inconsolata-DZ]]
  - [[https://sourcefoundry.org/hack/][Hack]]
  - [[https://fontawesome.com/][FontAwesome]]
- ZSH
  - [[https://github.com/getantibody/antibody][Antibody]]
  - [[https://github.com/junegunn/fzf][FZF]]
- Emacs
  - [[https://github.com/hlissner/doom-emacs][Doom Emacs]]
  - Emacs >= 27
- System utilities
  - [[https://github.com/wakatime/wakatime][Wakatime]]
  - [[https://www.gnu.org/software/emacs/][Emacs]]
  - [[https://www.chezmoi.io/][Chezmoi]]
  - [[https://github.com/BurntSushi/ripgrep][Ripgrep]]
  - [[https://github.com/pyenv/pyenv][pyenv]]
  - [[https://gohugo.io/][Hugo]]
  - [[https://bitwarden.com/help/article/cli/#quick-start][Bitwarden-cli]]
- OSX
  - [[https://brew.sh/][Homebrew]]
  - [[https://github.com/mas-cli/mas][Mas]]
- Linux
  - [[https://i3wm.org/][i3wm]]
  - [[https://github.com/fosskers/aura][Aura (Archlinux)]]
  - [[https://github.com/greshake/i3status-rust][i3status-rust]]

* Commands
These are general commands I use while managing my =dotfiles= and my system . I
run them in orgmode itself, but you can simply copy and paste it to your
terminal.
** Chezmoi :dotfiles:chezmoi:

- Apply dotfile changes with Chezmoi.
  #+begin_src shell
    cd $dir
    chezmoi apply -v
  #+end_src
- View difference between dotfiles and restores files.
  #+begin_src shell
    cd $dir
    chezmoi diff
  #+end_src

- Initialize chezmoi repository, reloading =$HOME/.config/chezmoi/chezmoi.[yaml|toml]=
  #+begin_src shell
    cd $dir
    chezmoi init ~/dotfiles
  #+end_src

- Bitwarden integration
  Chezmoi applies Bitwarden's in every file which requires a secret.

  As a result, it requires Bitwarden installed and logged with =bw login
    <email>=. Make sure you change my Bitwarden's UUID to match yours.

  You can test your UUID with:
  #+begin_src shell
    bw get item <uuid> | jq .login.password
  #+end_src

  Chezmoi will only run Bitwarden against these files if:
  - Environment is not set to =CI=
  - =chezmoi.yaml= has =secrets= set to =true=.

** Emacs :emacs:
General Emacs maintenance.

*** Doom emacs
- Doom compile core and private modules
  #+begin_src shell
    .emacs.d/bin/doom compile :core :private lang/org lang/python tools lang/yaml tools/lsp
  #+end_src

*** Required =authinfo= entries
Email and Forge requires the following entries to be set in your
=$HOME/.authinfo=. Make sure you encrypt =.authinfo= with PGP.

#+begin_src org
machine api.github.com login <gh-user>^forge password <password>
machine irc.freenode.net login <user> password <passord> port 6667
machine imap.gmail.com login <email> password <password> port 443
machine smtp.gmail.com login <email> password <password> port 587
#+end_src

** Linux :linux:
General Linux commands

- Speed up keyboard
  #+begin_src :cache
    xset r rate 180 40
  #+end_src

*** Archlinux :archlinux:
- List =pacman= packages ignoring foreing packages (AUR, etc).
  #+begin_src sh
    pacman -Qqen
  #+end_src

  #+results: Pacman list installed packages without AUR
  [[file:./roles/archlinux/tasks/pkgs.pacman]]

- Get list of foreing (AUR, etc) packages with =pacman=.
  #+begin_src sh
    pacman -Qqem
  #+end_src

  #+results: Pacman list AUR packages
  [[file:./roles/archlinux/tasks/pkgs.aur]]

- Enable color, total download, check space and verbose pkg list when running
  =pacman=.
  #+begin_src shell
    sudo sed -i '/Color$/s/^#//g' /etc/pacman.conf
    sudo sed -i '/TotalDownload$/s/^#//g' /etc/pacman.conf
    sudo sed -i '/CheckSpace$/s/^#//g' /etc/pacman.conf
    sudo sed -i '/VerbosePkgLists$/s/^#//g' /etc/pacman.conf
  #+end_src
- Find all =*.pacnew= files in =/etc=
  #+begin_src shell
    find /etc -regextype posix-extended -regex ".+\.pac(new|save)"
  #+end_src

**** Docker :docker:
- Allow Docker runs with non-root user.
  #+begin_src shell
    sudo usermod -aG docker $USER
    newgrp docker
  #+end_src

*** Sourcing env with i3
- For some reason, i3 is sourcing =.xprofile= instead of =xinitrc=, so for
  getting Github plugin for the [[file:dot_config/i3/status.toml][i3status-rust]] you need to set up a variable in
  your =.xprofile=
  #+begin_src shell
    export I3RS_GITHUB_TOKEN="your-github-token"
  #+end_src

** OSX
*** Set OSX defaults
#+begin_src shell
# Turn on app auto-update
defaults write com.apple.commerce AutoUpdate -bool true

# Install System data files & security updates
defaults write com.apple.SoftwareUpdate CriticalUpdateInstall -int 1

# Download newly available updates in background
defaults write com.apple.SoftwareUpdate AutomaticDownload -int 1

# Check for software updates daily, not just once per week
defaults write com.apple.SoftwareUpdate ScheduleFrequency -int 1

# Donâ€™t show recent applications in Dock
defaults write com.apple.dock show-recents -bool false

# Automatically hide and show the Dock
defaults write com.apple.dock autohide -bool true

# Remove the auto-hiding Dock delay
defaults write com.apple.dock autohide-delay -float 0
# Remove the animation when hiding/showing the Dock
defaults write com.apple.dock autohide-time-modifier -float 0
#+end_src


* Keybindings
** OSX
*** MPC
- =fn + cmd - e= - =opens editor=
- =cmd + return= - =opens alacritty=
- =fn + cmd - f1= - =mpc play=
- =fn + cmd - f2= - =mpc pause=
- =fn + cmd - f3= - =mpc prev=
- =fn + cmd - f4= - =mpc next=
- =fn + cmd - f5= - =mpc volume -10=
- =fn + cmd - f6= - =mpc volume +10=


* Troubleshooting
** Chezmoi does not seem to reload the configuration
Run =chezmoi init <dotfiles-path>= again. This should reload the configuration
by copying [[file:.chezmoi.yaml.tmpl][chezmoi.yaml]] to =$HOME/.config/chezmoi/chezmoi.yaml=.

* TODOS
** TODO Remove 1Password documents from the configuration file
1Password Documents are currently kept as I am slowly migrating to Bitwarden
** TODO Update README on how to install individual configs
** CANCELED Create multi-os support in travis
- [X] OSX support
- [X] Linux support
- [X] Get linux to run
- [X] How to handle AUR packages?
** DONE Verify if Github Workflow is caching packages property

** DONE Fix issue with tmux not correctly searching text through panes
** TODO Add Archlinux AUR packages
** DONE Figure out how to handle 1password-cli with Chezmoi when running Ansible

** DONE Switch to =Brewfile=
